   - name: Ping test with multiple ports
     hosts: all
     gather_facts: false
     tasks:
       - name: Check connectivity on each port
         ansible.builtin.wait_for:
           host: "{{ ansible_host }}"
           port: "{{ item }}"
           timeout: 5
           state: started
         loop: "{{ target_ports }}"
         register: port_results
         ignore_errors: true  # Handle cases where some ports might not be open

       - name: Gather results
         debug:
           msg: "Port {{ item.item }}: {{ item.state }}"
         loop: "{{ port_results.results }}"
         when: item is defined

       - name: Failed results
         debug:
           msg: "Port {{ item.item }}: {{ item.msg }}"
         loop: "{{ port_results.results }}"
         when: item.msg is defined

